---
title: "lab_1"
output: html_notebook
bibliography: references.bib
csl: abnt.csl
df_print: paged
---

# Primeira aula de laboratório, script 1[^1]

[^1]: Preparado por Thiago Fonseca Morello (CECS-UFABC).

O objetivo deste roteiro de aula é apresentar comandos básicos do R, comandos necessários para estimação de uma regressão linear múltipla e introduzir a interpretação das estimativas pontuais.

## Regressões que serão estimadas

1 - Infecções por COVID-19, gênero e características socioeconômicas, âmbito internacional [@abras2021].

<center>

infec_per_capita = $\beta_0$ + $\beta_1$dirigente_mulher + $\beta_2$fertilidade + $\beta_3$poluição + $\beta_4$lockdown + $\beta_5$ continente + u

</center>

2 - Mortalidade devido a COVID-19 e características socioeconômicas, âmbito internacional [@abras2021]

<center>

obitos_per_capita = $\beta_0$ + $\beta_1$dirigente_mulher + $\beta_2$fertilidade + $\beta_3$poluição + $\beta_4$lockdown + $\beta_5$continente + $\beta_6$infec_per_capita + u

</center>

3 - Equação de Mincer [@giuberti2005; @meara2020]

<center>

salário_hora_real = $\beta_0$ + $\beta_1$educação + $\beta_2$experiência + $\beta_3$setor + $\beta_4$ocupação + $\beta_5$gênero + $\beta_6$etnia + $\beta_7$região + $\beta_8$área_urbana + u~t~

</center>

## Dados

```{r}
# install.packages("tidyverse")
library(tidyverse)

load("aulas_praticas/aula_1/lab_1_dados.Rdata")

# convertendo para tibbles

db_cov <- db_cov |> dplyr::as_tibble(db_cov)

db_min <- db_min |> dplyr::as_tibble(db_cov)

db_cov

db_min
```

## Preparação dos dados para equações 1 e 2

É comum, em dados socieconômicos que algumas variáveis apresentem, para algumas unidades, valores não-observados. Em sondagens com aplicação de questionário à pessoas ou empresas, é o que se tem quando a informação não é concedida, i.e., o entrevistado se recusa a responder ou a questão não se aplica (p.ex., idade dos filhos não se aplica a família sem filhos). Em dados de países, como é o caso da base db_cov, trata-se de informação não gerada pelo país (p.ex., países em situação de guerra não possuem serviços estatísticos funcionando, e, portanto, não calculam PIB e outras estatísticas).

Dados faltantes:

```{r}
db_cov |> 
  dplyr::filter(is.na(fertility_)) |> 
  dplyr::tally() |> 
  dplyr::pull()
```

Fertilidade não observado para 19 países.

Limpando dados faltantes:

```{r}
db_covs <- db_cov |>
  dplyr::select(casos_por_milhao, obitos_por_milhao, fem_head, fertility_, airpoll_exposure_, d_lockdown, Continent, country) |>
  tidyr::drop_na()
```

Resumo estatístico das variáveis selecionadas:

```{r}
summary(db_covs)
```

Gráfico de dispersão de mortalidade vs infecções:

```{r, fig.align='center'}
db_covs |> 
  ggplot() +
  geom_point(aes(
    x = casos_por_milhao,
    y = obitos_por_milhao,
  )) +
  labs(
    x = "Infecções",
    y = "Óbitos"
  )
```

Qual é a direção da relação entre as duas variáveis?

Coeficientes de correlação com teste de significância: mortalidade vs infecções:

```{r}
# install.packages("broom") 
library(broom) # converte as funções estatísticas do R em tidy data

db_covs |> dplyr::do(
  cor.test(.$casos_por_milhao, .$obitos_por_milhao) |> 
    broom::tidy()
  ) # do() executa qualquer função (fora do tidyverse) envolvendo dataframes em um pipe.
```

A correlação é estatisticamente significativa ou não? Há contradição com o gráfico de dispersão? *R: É significativa e coerente com o gráfico.*

### Estatísticas-resumo por continente

Número médio de casos per capita por continente: qual continente apresentou maior prevalência de COVID-19?

```{r}
db_covs |> 
  dplyr::group_by(Continent) |> 
  dplyr::summarise(m_obitos_por_milhao = mean(obitos_por_milhao)) |>
  dplyr::arrange(m_obitos_por_milhao) |> 
  knitr::kable(col.names = c("Continente","Óbitos por milhão"))
```

Taxa média de letalidade: qual continente apresentou maior taxa de letalidade? A taxa de letalidade é uma medida da gravidade do impacto na saúde causado pelo COVID-19 ou do grau de risco de vida imposto pela aquisição do vírus.

```{r, warning=FALSE}
db_covs <- db_covs |>
  dplyr::mutate(letalidade = obitos_por_milhao/casos_por_milhao) # criando coluna com dados de letalidade
  
db_covs |>   
  dplyr::group_by(Continent) |> 
  dplyr::summarise(m_letalidade = mean(100*letalidade)) |>
  dplyr::arrange(m_letalidade) |> 
  knitr::kable(col.names = c("Continente", "Taxa de letalidade (%)"),
               digits = 2)
```

É o que esperávamos? Qual é a razão da diferençara do ranque comparando às outras classificações? *R: Provavelmente diferenças populacionais entre os continentes.*

Os percentis da distribuição empírica de uma variável permitem identificar valores discrepantes da tendência central (média), i.e., muito pequenos ou muito grandes.

```{r}
db_covs |>
  dplyr::summarise(letalidade = obitos_por_milhao/casos_por_milhao) |>
  dplyr::do(
    quantile(.$letalidade, 1:20/20) |> 
    broom::tidy()
  ) |>
  knitr::kable(col.names = c("Percentil", "Letalidade")) # Os valores da coluna "Letalidade" representam a distribuição da letalidade pelos percentis.
```

Detectando outliers (países que estão nos percentis 5% e 95%):

```{r}
db_covs |> 
  dplyr::filter(letalidade == 0) |> 
  dplyr::do(
   summary(.$Continent) |> 
     broom::tidy()
  ) |> 
  knitr::kable(col.names = c("Continente", "Frequência"),
               caption = "Número de países abaixo do percentil 5%")

db_covs |> 
  dplyr::filter(letalidade >= 0.087045428) |> 
  dplyr::do(
   summary(.$Continent) |> 
     broom::tidy()
  ) |> 
    knitr::kable(col.names = c("Continente", "Frequência"),
               caption = "Número de países acima do percentil 95%")

```

É o que esperávamos? Qual a característica de geografia física mais recorrente nesse grupo de países? *R: São ilhas.*

Quais são os países com letalidade muito alta? *R: Os continentais.*

É o que esperávamos? O que isso nos diz sobre o ranque continental?

## Preparação dos dados para equação 3

```{r}
db_min <- db_min |> 
  dplyr::select(sal_hor,anos_educ, exper_idade_trab, exper_idade_trab_sq, d_etnia_bca_ama, d_etnia_pre_par, d_hom, d_ativ_agro, d_ativ_indus, d_ativ_const, d_ativ_social, d_ativ_serv, d_ativ_apub, d_ocup_adm, d_ocup_agro, d_ocup_com, d_ocup_serv, d_ocup_dirigente, d_ocup_cie_art, d_ocup_tec_med, d_ocup_rep_manut, d_ocup_armada, d_reg_2, d_reg_3, d_reg_4, d_reg_5, d_urbano, ano)
```

Salário-hora vs educação:

```{r}
db_min |>
  dplyr::select(anos_educ,sal_hor,ano) |> 
  dplyr::filter(ano == 2015)


  ggplot +
  geom_point(aes(
    x = anos_educ,
    y = sal_hor,
  )) +
  labs(
    x = "Educação",
    y = "Salário-Hora"
  )
```

# Referências
